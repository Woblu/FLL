datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

// Enums and Types your project still uses
enum Role {
  USER
  ADMIN
}

enum ChangeType {
  ADD
  REMOVE
  MOVE
}

// --- CORE MODELS FOR FLL-LIST ---

model User {
  id               String            @id @default(auto()) @map("_id") @db.ObjectId
  email            String            @unique
  username         String            @unique
  password         String
  role             Role              @default(USER)
  createdAt        DateTime          @default(now())
  levelSubmissions LevelSubmission[]
}

model LevelRecord {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  username  String
  percent   Int
  videoId   String
  levelId   String @db.ObjectId
  level     Level  @relation(fields: [levelId], references: [id])
  createdAt DateTime @default(now())
}

model Level {
  id          String         @id @default(auto()) @map("_id") @db.ObjectId
  placement   Int
  name        String
  creator     String
  verifier    String
  levelId     Int            @unique
  videoId     String
  description String?
  list        String
  changes     ListChange[]
  records     LevelRecord[]
  @@map("levels")
}

model LevelSubmission {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  videoId       String
  creatorName   String
  verifierName  String
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  submittedBy   User     @relation(fields: [submittedById], references: [id])
  submittedById String   @db.ObjectId
}

model ListChange {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime   @default(now())
  type        ChangeType
  description String
  list        String     // This field was missing
  level       Level?     @relation(fields: [levelId], references: [id], onDelete: SetNull)
  levelId     String?    @db.ObjectId
}